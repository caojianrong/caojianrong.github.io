<html>
<head>
  <title>redux</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600986 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="806"/>
<h1>redux</h1>

<div>
<span><div><div><div style="text-align: center;"><font style="font-size: 18pt;"><span style="font-size: 18pt; color: rgb(255, 0, 0); font-weight: bold;">Redux全局状态管理</span></font></div><div style="text-align: center;"><span style="font-size: 18pt;"><span style="font-size: 18pt; font-weight: bold;">（npm install redux）</span></span></div><div style="text-align: left;"><span style="font-size: 14pt; font-weight: bold;">准备相关文件：</span><span style="font-size: 14pt;">store.js   state.js    reducer.js</span></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(255, 0, 0); font-weight: bold;">1.获取全局状态  </span></font></div><div><span style="font-size: 14pt;">   引入store对象</span></div><div><span style="font-size: 14pt;">   通过store对象的getState 方法获取全局状态值 </span></div><div><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(255, 0, 0); font-weight: bold;">2.组件修改全局状态值并更新页面</span></font></div><ul><li><div><span style="font-size: 14pt;">  全局状态值改变只能通过reducer 老佛爷，</span><span style="font-size: 14pt;"> store.dispach 方法可以提交一个对象，也就是action奏折 ；</span><span style="font-size: 14pt;">提交完action就会触发reducer ，</span><span style="font-size: 14pt;">该对象必须有type类型</span></div></li></ul><div><font style="font-size: 14pt;"><br/></font></div><ul><li><div><span style="font-size: 14pt;">    reducer 接受提交的actions 根据actions 修改之前的state数据并且返回新数据</span></div></li></ul><div><font style="font-size: 14pt;"><br/></font></div><ul><li><div><span style="font-size: 14pt;">  数据改变了页面不会发生改变</span></div></li><ul><li><div><span style="font-size: 14pt;">    在需要的组件里添加subscribe监听 该监听只要全局状态值改变了就会触发</span></div></li><li><div><span style="font-size: 14pt;">    触发之后 修改页面 this.setState({})</span></div></li></ul></ul><div><font style="font-size: 14pt;"><span style="font-size: 14pt; color: rgb(255, 0, 0); font-weight: bold;">3. 会将action 的创建以及派发 放到actionCreator里</span></font></div><ul><li><div><span style="font-size: 14pt;">store.getState()</span></div></li><li><div><span style="font-size: 14pt;">store.dispatch(actions)</span></div></li><li><div style="text-align: left;"><span style="font-size: 14pt;">store.subscribe(()=&gt;{})</span></div></li></ul><div style="text-align: left;"><span style="font-size: 14pt;"><br/></span></div><hr/><div><font color="#FF0000" style="font-size: 16pt;"><br/></font></div></div><div><font style="font-size: 16pt; color: rgb(255, 0, 0);"><span style="font-size: 16pt; color: rgb(255, 0, 0); font-weight: bold;">一、react-redux</span></font></div><ul><li><div><font style="font-size: 14pt;"><span style="font-size: 14pt;">需要和redux配合使用；</span></font></div></li><li><div><span style="font-size: 18.6667px;">作用仅仅是简化redux；</span></div></li><li><div><span style="font-size: 14pt;">Provider提供器；</span></div></li><li><div><span style="font-size: 18.6667px;">connect 函数返回一个高阶组件：</span></div></li><ul><li><div><font style="font-size: 12pt;">参数1：<font style="color: rgb(255, 0, 0);"><b>mapStateToprops</b></font> 是一个函数，接收全局状态值为参数，返回的对象会映射到props里；</font></div></li><li><div><font style="font-size: 12pt;">参数2：如果不需要可以不写，<font style="color: rgb(255, 0, 0);"><b>mapdispathToProps </b></font> 也是一个函数，接收dispatch为参数，返回的对象也会被映射到props里</font></div></li></ul></ul><div><font style="font-size: 14pt;"><b>1、provider提供器</b></font></div><div><font style="font-size: 12pt;">将store对象注册到全局上下文：</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">```js</font></div><div><font style="font-size: 12pt;">&lt;Provider store={store}&gt;</font></div><div><font style="font-size: 12pt;">  &lt;App /&gt;</font></div><div><font style="font-size: 12pt;">&lt;/Provider&gt;</font></div><div><font style="font-size: 12pt;">```</font></div></div><div><font style="font-size: 14pt;"><b><br/></b></font></div><div><font style="font-size: 14pt;"><b>2、connect</b></font></div><div style="margin-left: 40px;"><font style="font-size: 12pt;">是一个函数 返回一个高阶组件</font></div><div style="margin-left: 40px;"><font style="font-size: 12pt;">connect(mapStateToprops,mapdispatchToProps)(要处理的组件)</font></div><ul><li><div><font style="font-size: 12pt;">获取数据从props里找</font></div></li><li><div><font style="font-size: 12pt;">不需要做subscribe监听</font></div></li><li><div><font style="font-size: 12pt;">actionCreator本身实现创建action 以及发送action的功能使用connect </font></div></li></ul><div><font style="font-size: 12pt;">actionCreator 只需要创建action 然后将方法映射到props 调用方法的时候会自动提交</font></div><div><font style="font-size: 12pt;">action</font></div><ul><li><div><span style="font-size: 12pt;"><b><font style="color: rgb(255, 0, 0);">bindActionCreators </font></b></span><span style="font-size: 12pt;">可以将actionCreator所有的函数映射到props ，而且在调用的时候自动通过dispatch 发送action</span></div></li></ul><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><b><font color="#FF0000"><span style="font-size: 16px;">将全局公共状态作为参数传入，在</span><font style="font-size: 12pt;">mapStateToprops中本身可以返回一个对象;</font></font></b></div><div><b><font color="#FF0000"><font style="font-size: 12pt;">而公共状态state也是一个对象，所以可以将state传入直接返回（state=&gt;state）</font></font></b></div><div><br/></div><div>import {connect} from 'react-redux'</div><div>import {bindActionCreators} from 'redux'</div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">&lt;button onClick={()=&gt;{</font></div><div><font style="font-size: 12pt;">   // ActionCreator.changeAge(999)</font></div><div>   <b> </b><font style="font-size: 12pt;"><b>//使用<font color="#FF0000">bindActionCreators</font>后在props中调用</b></font></div><div><font style="font-size: 12pt;">         <b><font color="#328712"> </font><font color="#FF0000">this.props.changeAge</font><font color="#000000">(888) </font><font color="#328712"> </font></b></font></div><div><font style="font-size: 12pt;">     }</font></div><div><font style="font-size: 12pt;"> }&gt;改年龄&lt;/button&gt;</font></div><div><br/></div><div><br/></div><div><font style="font-size: 12pt;">let <b><font style="color: rgb(255, 0, 0);">mapStateToprops</font></b>=(state)=&gt;{</font></div><div><font style="font-size: 12pt;">  console.log(state)</font></div><div><font style="font-size: 12pt;">  // return {hehe:123,xixi:456}</font></div><div><font style="font-size: 12pt;">  return state</font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">let <font color="#FF0000"><b>mapDispathchToprops</b></font>=(dispatch)=&gt;{</font></div><div><font style="font-size: 12pt;">  <span> </span>console.log(dispatch)</font></div><div><font style="font-size: 12pt;">   return <font style="color: rgb(255, 0, 0);"><b>bindActionCreators</b></font>(ActionCreator,dispatch)</font></div><div><span style="font-size: 16px;"><br/></span></div><div><span style="font-size: 16px;">或</span></div><div><font style="font-size: 12pt;">   return{</font></div><div><font style="font-size: 12pt;">     hehe:()=&gt;{      </font>            <font color="#41AD1C"><b><font style="font-size: 12pt;"> </font><font style="font-size: 12pt;"><span>    </span><span>    </span>//hehe方法也同样映射到props里</font></b></font></div><div><font style="font-size: 12pt;">       let action=ActionCreator.changeAge(777)</font></div><div><font style="font-size: 12pt;">        dispatch(action)</font></div><div><font style="font-size: 12pt;">     }  <span>    </span><span>    </span><span>    </span><span>    </span><span>   </span></font></div><div><font style="font-size: 12pt;">   }</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">}</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">export default <b><font color="#FF0000">connect</font></b>(state=&gt;state,mapDispathchToprops)(Hello)</font></div><div><font style="font-size: 12pt;"><br/></font></div></div><div><br/></div><div><br/></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0); font-weight: bold;">二、异步actions  </span></div><div><font style="font-size: 14pt;"><b>在actions里写异步，actions里做网络请求</b></font></div><div><font style="font-size: 12pt;"><b>异步中间件（一个处理异步的插件，一个中间件）：</b></font></div><ul><li><div><font style="font-size: 12pt;">redux-thunk   </font></div></li><li><div><font style="font-size: 12pt;">redux-sage   </font></div></li><li><div><font style="font-size: 12pt;">redux-promise..........</font></div></li></ul><div><span style="font-size: 16px;"><br/></span></div><div><b><font style="font-size: 14pt;">异步中间件的使用：</font></b></div><div><font style="font-size: 12pt;">1、在store里引入中间件，异步插件；</font></div><div><font style="font-size: 12pt;">2、创建store对象的时候使用异步中间件；</font></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">createStore(reducer,applyMiddleWere(thunk))</font></div></div><ul><li><div><font style="font-size: 12pt;">acctionCreator内部如果不涉及到异步，创建action，返回action</font></div></li><li><div><font style="font-size: 12pt;">acctionCreator内部如果涉及到异步，返回一个函数可以接受dispatch，在方法内部做异步操作，操作结束后手动dispatch  action</font></div></li></ul><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">  changeAge(params){</font></div><div><font style="font-size: 12pt;">    // 返回一个函数 可以接受dispatch</font></div><div><font style="font-size: 12pt;">   <font color="#FF0000">return (dispatch)=&gt;{</font></font></div><div><font color="#FF0000" style="font-size: 12pt;">     setTimeout(()=&gt;{</font></div><div><font color="#FF0000" style="font-size: 12pt;">       let action={</font></div><div><font color="#FF0000" style="font-size: 12pt;">         type:'CHANGE_AGE',</font></div><div><font color="#FF0000" style="font-size: 12pt;">         params:params</font></div><div><font color="#FF0000" style="font-size: 12pt;">       }</font></div><div><font color="#FF0000" style="font-size: 12pt;">      //  手动dispatch action</font></div><div><font color="#FF0000" style="font-size: 12pt;">      dispatch(action)</font></div><div><font color="#FF0000" style="font-size: 12pt;">     },1000)</font></div><div><font color="#FF0000" style="font-size: 12pt;">   }</font></div><div><font style="font-size: 12pt;">  }</font></div></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 